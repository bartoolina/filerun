Ext.getCmp("gridTabPanel").add(new FR.components.editForm({title:"Add User",items:{xtype:"tabpanel",activeTab:0,deferredRender:false,enableTabStripOverflow:true,defaults:{autoScroll:true,hideMode:"offsets"},listeners:{render:function(){if(!FR.user.isSuperuser){this.hideTabStripItem(3)}}},items:[{title:"Basic Information",items:[{xtype:"fieldset",title:"Login Info",width:500,defaults:{width:200},items:[{xtype:"compositefield",fieldLabel:"Name",items:[{flex:1,xtype:"textfield",name:"name"},{flex:1,xtype:"textfield",name:"name2"}]},{xtype:"textfield",fieldLabel:"Username",name:"unm",value:""},{xtype:"trigger",fieldLabel:"Password",name:"pwd",triggerClass:"fa fa-key",onTriggerClick:function(){this.setValue(randomPass(12,true,true,true,true,2));this.el.dom.select()}},{xtype:"checkbox",boxLabel:"Require user to change the password",width:350,value:1,name:"require_password_change",checked:false},{xtype:"checkbox",boxLabel:"Enable 2-step verification",width:350,value:1,name:"two_step_enabled",checked:FR.system.require_2fa,readOnly:FR.system.require_2fa,helpText:"In order for the user to login, he will need to type in also a temporary code which can be generated on a mobile device with a dedicated app such as Google Authenticator."}]},{xtype:"fieldset",width:500,defaults:{width:200},disabled:FR.system.isFree||FR.system.isFreelancer,items:[{xtype:"datefield",fieldLabel:"Expiration date",minValue:new Date,helpText:"The user account will be automatically deactivated at the specified date.",name:"expiration_date",value:""}]},{xtype:"fieldset",title:"E-mail Options",width:500,defaults:{width:200},items:[{xtype:"textfield",fieldLabel:"E-mail address",name:"email",value:""},{xtype:"checkbox",boxLabel:"Notifications",helpText:FR.T("If checked, this option gets the user notified when:")+'<div style="margin-top:5px;">&bull; '+FR.T("A file has been downloaded by another user.")+"</div>"+"<div>&bull; "+FR.T("Another user provided a file or a folder via copying, moving, uploading or sharing.")+"</div>"+"<div>&bull; "+FR.T("Another user added a comment or set a label on a file or a folder.")+"</div>"+(FR.system.isFree?"":"<div>&bull; "+FR.T("The space quota, if one is set, is about to hit the usage limit.")+"</div>"),inputValue:1,name:"receive_notifications",checked:false},{xtype:"checkbox",boxLabel:"Send a notification now",helpText:"An e-mail message with the login information will be sent to the user's address.",inputValue:1,name:"notify",checked:false}]},{xtype:"fieldset",title:"Details",width:500,defaults:{width:200},items:[{xtype:"textfield",fieldLabel:"Phone",name:"phone",value:""},{xtype:"textfield",fieldLabel:"Company",name:"company",value:""},{xtype:"textfield",fieldLabel:"Website",name:"website",value:""},{xtype:"textfield",fieldLabel:"Logo URL",name:"logo_url",value:""},{xtype:"textarea",fieldLabel:"Note",name:"description",value:""}]}]},{title:"Permissions",defaults:{xtype:"fieldset",width:500},items:[{ref:"roleFieldset",labelWidth:100,items:[{xtype:"combo",helpText:"The role defines the user's permission settings. The individual permission settings of the user cannot be changed if a role is selected.",fieldLabel:"Role",name:"perms[role]",hiddenName:"perms[role]",ref:"../role",autoCreate:true,mode:"local",editable:false,emptyText:"Select...",displayField:"name",valueField:"id",triggerAction:"all",disableKeyFilter:true,value:"-",store:new Ext.data.SimpleStore({fields:["id","name"],data:FR.roles}),listeners:{beforeselect:function(f,record){f.ownerCt.ownerCt.items.each(function(fieldset){if(fieldset.ref!="roleFieldset"){fieldset.setVisible(record.data.id=="-")}});f.ownerCt.ownerCt.ownerCt.adminTab.setDisabled(record.data.id!="-")}}}]},{hidden:FR.currentUserPerms.admin_homefolder_template,title:"Home folder",labelWidth:100,items:[{xtype:"textfield",ref:"homefolder",fieldLabel:"Path",name:"perms[homefolder]",width:330,helpText:FR.user.isIndep?FR.T("This folder will be automatically created in your home folder, if it doesn't exists already."):FR.T("Type the path to a folder on your server. This is the user's personal working space.")+"<br><br>"+FR.T("As an example path, this app is located at %1").replace("%1","<strong>"+FR.FileRunInstallPath+"</strong>"),value:""},{xtype:"compositefield",hidden:FR.user.isIndep,width:300,items:[{xtype:"textfield",value:"",hidden:true},{xtype:"button",text:"Check path",cls:"fr-btn-default fr-btn-smaller",handler:function(){var fieldset=this.ownerCt.ownerCt.ownerCt;var par={path:fieldset.homefolder.getValue()};var output=fieldset.serverReply;output.show();FR.utils.getAjaxOutput(FR.URLRoot+"/?module=users&section=cpanel&page=check_path",par,output)}},{xtype:"button",text:"Create folder now",cls:"fr-btn-default fr-btn-smaller",style:"margin-left:5px",handler:function(){var fieldset=this.ownerCt.ownerCt.ownerCt;var par={path:fieldset.homefolder.getValue()};var output=fieldset.serverReply;output.show();FR.utils.getAjaxOutput(FR.URLRoot+"/?module=users&section=cpanel&page=create_path",par,output)}}]},{xtype:"displayfield",ref:"serverReply",value:"test",style:"border:1px solid silver;padding:3px;",hidden:true}]},{title:"Permissions",labelWidth:10,items:[{xtype:"fieldset",title:"Access",defaults:{xtype:"checkbox"},items:[{boxLabel:"User can download files",value:1,name:"perms[download]",checked:true,listeners:{check:function(field,checked){this.ownerCt.ownerCt.shareFieldSet.setDisabled(!checked);this.ownerCt.canPreview.setValue(checked?1:0);this.ownerCt.canPreview.setDisabled(checked);this.ownerCt.downloadFolders.setDisabled(!checked);this.ownerCt.fileLog.setDisabled(!checked)}}},{boxLabel:"User can preview files",value:1,name:"perms[preview]",checked:true,ref:"canPreview",disabled:true},{boxLabel:"User can download folders and collections",value:1,ref:"downloadFolders",name:"perms[download_folders]",checked:true,helpText:"Without this permission, users are not able to zip or share folders."},{boxLabel:"User can read comments and view labels",value:1,name:"perms[read_comments]",checked:true},{boxLabel:"User can access tags, ratings and other metadata",value:1,name:"perms[metadata]",checked:true},{boxLabel:"User can access the files' activity logs",value:1,ref:"fileLog",hidden:FR.settings.disable_file_history,disabled:FR.system.isFree,name:"perms[file_history]",checked:false}]},{xtype:"fieldset",title:"Share",ref:"shareFieldSet",defaults:{xtype:"checkbox"},items:[{boxLabel:"User can share with other users",value:1,name:"perms[share]",checked:false,listeners:{check:function(field,checked){this.ownerCt.shareWithGuests.setDisabled(!checked)}}},{boxLabel:"User can share with guest users",value:1,ref:"shareWithGuests",name:"perms[share_guests]",checked:false,disable:true},{boxLabel:"User can share via web links",name:"perms[weblink]",checked:true},{boxLabel:"User can share via e-mail",value:1,name:"perms[email]",checked:true}]},{xtype:"fieldset",title:"Change",defaults:{xtype:"checkbox"},items:[{boxLabel:"User can upload files and folders",value:1,name:"perms[upload]",checked:true},{boxLabel:"User can make changes to files and folders",value:1,name:"perms[changes]",checked:true},{boxLabel:"User can write comments and set labels",value:1,name:"perms[write_comments]",checked:true},{xtype:"displayfield",value:""},{boxLabel:"User can change the password",value:1,name:"perms[change_pass]",checked:true},{boxLabel:"User can change personal information",value:1,name:"perms[edit_profile]",checked:true}]}]},{labelWidth:150,title:"Can interact with",items:[{xtype:"userslistfield",allowAll:true,allItemsText:FR.T("[All users]"),helpText:"Use this setting to allow the user to access folders shared by other users.",showSelf:true,hideLabel:true,tcfg:{height:150,width:280},name:"users_may_see",value:"-ALL-"}]},{labelWidth:150,defaultType:"textfield",defaults:{width:60},items:[{fieldLabel:"Space quota",name:"perms[space_quota_max]",helpText:FR.system.isFree?"Enterprise version only":"The values are in megabytes. The value of 0 disables the limitation.",disabled:FR.system.isFree,value:""},{fieldLabel:"Upload max file size",name:"perms[upload_max_size]",value:"",helpText:"The values are in megabytes. The value of 0 disables the limitation."},{fieldLabel:"Allowed file types",name:"perms[upload_limit_types]",value:"",width:250,helpText:FR.T("Specify a list of file types the user will be limited to when upload files.")+"<br>"+FR.T("An empty field will allow the user to upload any type of file.")+"<br><br>"+FR.T("Example list:")+" jpg,mp3,docx,txt"}]}]},{title:"Groups",ref:"groupsTab",items:[{xtype:"panel",layout:"form",items:[{xtype:"userslistfield",name:"groups",only:"groups",value:"",fieldLabel:"User group(s)",tcfg:{height:150,width:280}}]}]},{title:"Admin",ref:"adminTab",items:[{xtype:"fieldset",width:380,disabled:FR.system.isFree||FR.system.isFreelancer,disabledMaskText:FR.T("Available in the %1 version").replace("%1",'<a href="https://filerun.com/get-enterprise" target="_blank">Enterprise FileRun</a>'),items:[{xtype:"radiogroup",fieldLabel:"Admin",columns:1,items:[{boxLabel:"No",name:"perms[admin_type]",inputValue:"",value:"",checked:true},{boxLabel:"Yes",name:"perms[admin_type]",inputValue:"simple",value:"simple",checked:false},{boxLabel:"Yes, Independent",name:"perms[admin_type]",inputValue:"indep",value:"indep",checked:false,helpText:FR.T("- Can only see and manage users, groups, etc. created by himself.")+"<br>"+FR.T("- He can assign space quotas within a total of his own space quota.")}],listeners:{change:function(f,checked){f.ownerCt.ownerCt.adminPermsFieldset.setVisible(checked.value=="simple");f.ownerCt.ownerCt.adminHomeFolderFieldset.setVisible(checked.value!="");f.ownerCt.ownerCt.maxUsersFieldset.setVisible(checked.value=="indep")}}}]},{ref:"adminPermsFieldset",xtype:"fieldset",title:"Admin permissions",width:500,hidden:true,defaults:{xtype:"checkbox"},items:[{boxLabel:"User can create new user accounts.",inputValue:1,name:"perms[admin_users]",checked:true},{boxLabel:"User can manage roles.",inputValue:1,name:"perms[admin_roles]",checked:true},{boxLabel:"User can manage notifications.",inputValue:1,name:"perms[admin_notifications]",checked:true},{boxLabel:"User can access the activity logs.",inputValue:1,name:"perms[admin_logs]",checked:true},{boxLabel:"User can change the metadata settings.",inputValue:1,name:"perms[admin_metadata]",checked:true},{xtype:"displayfield",value:""},{xtype:"userslistfield",only:"groups",allowAll:true,allItemsText:"[All groups]",name:"perms[admin_over]",value:"-ALL-",fieldLabel:"Can manage",tcfg:{height:150,width:280}}]},{ref:"maxUsersFieldset",xtype:"fieldset",width:500,hidden:true,items:[{xtype:"textfield",fieldLabel:"Max users",name:"perms[admin_max_users]",width:60,helpText:FR.T("This is the maximum number of user accounts this independent admin user can create.")+"<br>"+FR.T("Setting the value to zero will allow the admin to add an unlimited number of users."),value:""}]},{ref:"adminHomeFolderFieldset",xtype:"fieldset",width:500,hidden:true,items:[{xtype:"textfield",fieldLabel:"Home folder<br>template path",name:"perms[admin_homefolder_template]",width:300,helpText:FR.T("The users created by this administrator will have their home folders set depending on this template.")+"<br>"+FR.T("Leave the field empty to allow the admin to set the paths manually.")+"<br><br>"+FR.T("Example: /home/users/{USERNAME}")+"<br><br>"+FR.T("{USERNAME} will be automatically replaced with each user's login name.")+"<br>"+FR.T("{ADMUSERNAME} will be automatically replaced with this user's login name.")+"<br>"+FR.T("{NAME} will be automatically replaced with this user's name.")+"<br>"+FR.T("{EMAIL} will be automatically replaced with this user's e-mail.")+"<br>"+FR.T("{COMPANY} will be automatically replaced with this user's company name."),value:""}]}]}]},tbar:[{text:"Add User",cls:"fr-btn-primary",ref:"saveBtn",handler:function(){this.ownerCt.ownerCt.submitForm({url:FR.URLRoot+"/?module=users&section=cpanel&page=add&action=add",maskText:"Adding user..."})}}]})).show();