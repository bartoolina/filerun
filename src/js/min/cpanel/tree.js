FR.initTree=function(){var displayed=[];var opts={adminSection:{text:FR.T("Admin users"),id:"admin",iconCls:"fa-users-cog",expanded:true,module:FR.user.perms.adminUsers?FR.modules.users:false,children:[{text:FR.T("Roles"),id:"roles",iconCls:"fa-user-tie",leaf:true,module:FR.modules.roles,hidden:!FR.user.perms.adminRoles},{text:FR.T("Groups"),id:"groups",iconCls:"fa-group",leaf:true,module:FR.modules.groups,hidden:!FR.user.perms.adminUsers},{text:FR.T("Activity logs"),id:"activity-logs",leaf:true,iconCls:"fa-book",module:FR.modules.logs,hidden:!FR.user.perms.adminLogs},{text:FR.T("Web Links"),iconCls:"fa-link",leaf:true,id:"web-links",module:FR.modules.weblinks},{text:FR.T("More"),id:"users",iconCls:"fa-user",cls:"adminSection",children:[{text:FR.T("Users online"),hidden:!FR.system.enableUsersOnline,iconCls:"fa-user-circle",leaf:true,appURL:FR.URLRoot+"/?module=cpanel&section=tools&page=users_online"},{text:FR.T("Storage usage"),iconCls:"fa-chart-pie",leaf:true,id:"space-quota",appURL:FR.URLRoot+"/?module=cpanel&section=tools&page=space_quota"},{text:FR.T("Import users"),hidden:!FR.user.isSuperuser,iconCls:"fa-file-upload",leaf:true,id:"import-users",appURL:FR.URLRoot+"/?module=users&section=import"},{text:FR.T("Export users"),hidden:!FR.user.isSuperuser,iconCls:"fa-file-download",leaf:true,id:"export-users",appURL:FR.URLRoot+"/?module=users&section=cpanel&page=export"}]}]},iface:{text:FR.T("Interface"),id:"interface",iconCls:"fa-sidebar",expanded:true,appURL:FR.URLRoot+"/?module=cpanel&section=settings&page=interface",children:[{text:FR.T("Branding"),iconCls:"fa-palette",leaf:true,id:"interface-branding",appURL:FR.URLRoot+"/?module=cpanel&section=settings&page=branding"}]},files:{text:FR.T("Files"),id:"files",iconCls:"fa-file",appURL:FR.user.isSuperuser?FR.URLRoot+"/?module=cpanel&section=settings&page=files":false,expanded:true,children:[{text:FR.T("Thumbs and previews"),iconCls:"fa-image",leaf:true,id:"files-preview",hidden:!FR.user.isSuperuser,appURL:FR.URLRoot+"/?module=cpanel&section=settings&page=image_preview"},{text:FR.T("Plugins"),iconCls:"fa-puzzle-piece",expanded:true,hidden:!FR.user.isSuperuser,module:FR.modules.openWith,id:"files-plugins",children:[{text:FR.T("Defaults"),leaf:true,id:"files-plugins-defaults",module:FR.modules.defaultOpenWith,iconCls:"fa-puzzle-piece"}]},{text:FR.T("Searching"),iconCls:"fa-file-search",leaf:true,hidden:!FR.user.isSuperuser,appURL:FR.URLRoot+"/?module=cpanel&section=settings&page=file_search",id:"searching"},{text:FR.T("Metadata"),iconCls:"fa-sticky-note",expanded:true,id:"metadata",children:[{text:FR.T("File types"),leaf:true,iconCls:"fa-file",id:"metadata-file-types",module:FR.modules.metadata_filetypes},{text:FR.T("Field sets"),leaf:true,id:"metadata-fieldsets",iconCls:"fa-edit",module:FR.modules.metadata_fieldsets}]}]},email:{text:FR.T("E-mail"),id:"email",iconCls:"fa-envelope",expanded:true,cls:FR.user.isSuperuser?"":"adminSection",appURL:FR.user.isSuperuser?FR.URLRoot+"/?module=cpanel&section=settings&page=email":false,children:[{text:FR.T("Notifications"),leaf:true,iconCls:"fa-bell",module:FR.modules.notifications,id:"email-notifications"},{text:FR.T("Logs"),leaf:true,hidden:!FR.user.isSuperuser,module:FR.modules.notif_logs,id:"email-logs",iconCls:"fa-book"}]},sec:{text:FR.T("Security"),id:"security",iconCls:"fa-shield-alt",expanded:true,appURL:FR.URLRoot+"/?module=cpanel&section=settings&page=security",children:[{text:FR.T("Authentication"),leaf:true,iconCls:"fa-key",appURL:FR.URLRoot+"/?module=cpanel&section=settings&page=authentication",id:"authentication"},{text:FR.T("Sign up"),leaf:true,iconCls:"fa-edit",appURL:FR.URLRoot+"/?module=cpanel&section=settings&page=registration",id:"registration"},{text:FR.T("Password policy"),leaf:true,iconCls:"fa-shield-check",appURL:FR.URLRoot+"/?module=cpanel&section=settings&page=passwords",id:"password-policy"},{text:FR.T("Guest users"),leaf:true,iconCls:"fa-user-clock",appURL:FR.URLRoot+"/?module=cpanel&section=settings&page=guest_users",id:"guest-users"},{text:FR.T("API"),id:"api",expanded:true,iconCls:"fa-network-wired",appURL:FR.URLRoot+"/?module=cpanel&section=settings&page=oauth",children:[{text:FR.T("Clients"),leaf:true,id:"api-clients",module:FR.modules.oauth2_clients,iconCls:"fa-phone-laptop"}]}]},thirdParty:{text:FR.T("Third party services"),leaf:true,id:"third-party",iconCls:"fa-globe",appURL:FR.URLRoot+"/?module=cpanel&section=settings&page=third_party"},more:{text:FR.T("More"),leaf:true,id:"more",iconCls:"fa-cog",appURL:FR.URLRoot+"/?module=cpanel&section=settings&page=misc"},filerun:{text:"FileRun",id:"filerun",icon:"?page=logo_small",expanded:true,children:[{text:FR.T("Update"),leaf:true,id:"update",iconCls:"fa-sparkles",appURL:FR.URLRoot+"/?module=software_update&section=cpanel"},{text:FR.T("License"),leaf:true,id:"license",iconCls:"fa-scroll-old",appURL:FR.URLRoot+"/?module=cpanel&section=settings&page=license"}]}};if(FR.user.isIndep||FR.user.perms.adminUsers){displayed.push(opts.adminSection)}if(FR.user.isSuperuser||FR.user.perms.adminNotif||FR.user.perms.adminMetadata){}if(FR.user.isSuperuser){displayed.push(opts.iface)}if(FR.user.isSuperuser||FR.user.perms.adminMetadata){displayed.push(opts.files)}if(FR.user.isSuperuser||FR.user.perms.adminNotif){displayed.push(opts.email)}if(FR.user.isSuperuser){displayed.push(opts.sec);displayed.push(opts.thirdParty);displayed.push(opts.more);displayed.push(opts.filerun)}this.tree={init:function(){this.panel=new Ext.tree.TreePanel({region:"west",split:true,width:280,id:"FR-cPanel-Tree",stateful:false,autoScroll:true,rootVisible:false,listeners:{contextmenu:function(tree,e){e.stopEvent();return false}},root:{expanded:true,id:"cpanel",children:displayed}});this.panel.getSelectionModel().on("selectionchange",function(selectionModel,treeNode){FR.tsel=treeNode.attributes;if(FR.tsel.module){if(FR.tsel.module.type=="grid"){Ext.getCmp("cardDisplayArea").getLayout().setActiveItem(0);FR.grid.loadModule(FR.tsel.module)}else{if(FR.tsel.module.activeItem){Ext.getCmp("cardDisplayArea").getLayout().setActiveItem(FR.tsel.module.activeItem)}}}else{if(FR.tsel.appURL){Ext.getCmp("cardDisplayArea").getLayout().setActiveItem(1);Ext.getCmp("appTab").removeAll(true);FR.tempPanel.load({url:FR.tsel.appURL,nocache:true,scripts:true})}}var path=treeNode.getPath();window.history.pushState({path:path},"","#"+path)});this.panel.getSelectionModel().on("beforeselect",function(selectionModel,treeNode){var a=treeNode.attributes;if(a.id=="metadata"||a.id=="filerun"){treeNode.firstChild.select();return false}if(["sysConfMenuItem","adminSection"].indexOf(a.cls)!=-1){treeNode.expand();return false}});this.panel.getRootNode().on("load",function(){window.setTimeout(function(){if(FR.user.perms.adminUsers){var path=decodeURI(document.location.hash.substring(1));if(!path){path="/cpanel/admin"}FR.tree.panel.selectPath(path,"id",function(t,node){if(node){node.ensureVisible()}else{FR.tree.panel.selectFirstVisible()}})}},200)})}};this.tree.init()};