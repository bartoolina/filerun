FR.licensing={getHTML:function(){var html="";if(licenseInfo.key){html+="<p>"+FR.T("FileRun license key in use: %1").replace("%1","<b>"+licenseInfo.key+"</b>")+"</p>";html+="<br><p>"+FR.T("Current FileRun version: %1").replace("%1","<b>"+licenseInfo.version+"</b>")+"</p>";html+="<br><p>"+FR.T("You are using <b>%1 user accounts</b> out of <b>%2</b>.").replace("%1",licenseInfo.users.current).replace("%2",licenseInfo.users.maximum)+"</p>";if(licenseInfo.dates.expiry){html+="<br><span>"+FR.T("%1 license renewal date: %2").replace("%1",licenseInfo.paidLicenseType).replace("%2",(licenseInfo.expired?'<span style="font-weight:bold;color:var(--theme-textDanger)">':'<span style="font-weight:bold">')+licenseInfo.dates.expiry+"</span>")+"</span>";html+="<br><p>"+(licenseInfo.expired?FR.T("The installation is now running the free FileRun version.")+"<br>"+FR.T("Renew the subscription to get back to the Enterprise version."):FR.T("The installation will fallback to the free FileRun version past this date."))+"</p>"}if(licenseInfo.contact){html+="<br><p>"+FR.T("Contact associated with this license: %1").replace("%1","<b>"+licenseInfo.contact+"</b>")+"</p>"}}else{html+="<br><p>"+FR.T("You are using <b>%1 user accounts</b> out of <b>%2</b>.").replace("%1",licenseInfo.users.current).replace("%2",licenseInfo.users.maximum)+"</p>";html+="<br><p>"+FR.T("Click the above button to register your FileRun copy.")+"</p>";html+="<br><p>"+FR.T('Read <a href="https://filerun.com/register" target="_blank">here</a> about the benefits of registering.')+"</p>"}html+="<br><p>"+FR.T('For more information about FileRun, please visit <a href="https://filerun.com" target="_blank">https://filerun.com</a>.')+"</p>";return html},promptForEmail:function(){new Ext.ux.prompt({text:FR.T("<p>Please type your e-mail address.</p><p>It will be kept safe and you will not receive any unwanted messages.</p> <p>It is needed for receiving a private license key which will give you access to the software update server.</p>"),defaultValue:userEmail,confirmBtnLabel:"Next",confirmHandler:function(emailAddress,d,prompt){FR.licensing.panel.bwrap.mask("Please wait...");Ext.Ajax.request({url:FR.URLRoot+"/?module=cpanel&section=settings&page=license&action=request",params:{emailAddress:emailAddress},callback:function(){if(FR.licensing.panel){FR.licensing.panel.bwrap.unmask()}},success:function(req){try{var rs=Ext.util.JSON.decode(req.responseText)}catch(er){return false}if(rs.success){if(rs.msg){new Ext.ux.prompt({text:rs.msg,callback:function(){FR.licensing.promptForKey()}})}else{FR.licensing.promptForKey()}}else{if(rs.msg){new Ext.ux.prompt({text:rs.msg,callback:function(){FR.licensing.promptForEmail()}})}}},failure:function(f,a){new Ext.ux.prompt({text:f.responseText,callback:function(){FR.licensing.promptForEmail()}})},scope:this});prompt.close()},scope:this})},promptForKey:function(msg){new Ext.ux.prompt({text:FR.T("Please paste here the received license key")+":",defaultValue:"",confirmHandler:function(lkey,d,prompt){FR.licensing.panel.bwrap.mask("Please wait...");Ext.Ajax.request({url:FR.URLRoot+"/?module=cpanel&section=settings&page=license&action=applyKey",params:{key:lkey},callback:function(){if(FR.licensing.panel){FR.licensing.panel.bwrap.unmask()}},success:function(req){try{var rs=Ext.util.JSON.decode(req.responseText)}catch(er){return false}if(rs.success){if(rs.msg){FR.feedback(rs.msg,"success")}Ext.getCmp("appTab").removeAll(true);FR.tempPanel.load({url:FR.URLRoot+"/?module=cpanel&section=settings&page=license",scripts:true})}else{if(rs.msg){new Ext.ux.prompt({text:rs.msg,callback:function(){FR.licensing.promptForKey()}})}}},failure:function(f,a){new Ext.ux.prompt({text:f.responseText,callback:function(){FR.licensing.promptForKey()}})},scope:this})}})},refresh:function(){Ext.getCmp("appTab").removeAll(true);FR.tempPanel.load({url:FR.URLRoot+"/?module=cpanel&section=settings&page=license",scripts:true})},update:function(){FR.licensing.panel.bwrap.mask("Please wait...");Ext.Ajax.request({url:FR.URLRoot+"/?module=cpanel&section=settings&page=license&action=update",callback:function(){if(FR.licensing.panel){FR.licensing.panel.bwrap.unmask()}},success:function(req){try{var rs=Ext.util.JSON.decode(req.responseText)}catch(er){return false}if(rs.msg){new Ext.ux.prompt({text:rs.msg});FR.licensing.refresh()}},failure:function(f,a){new Ext.ux.prompt({text:f.responseText})},scope:this})},unregister:function(){new Ext.ux.prompt({text:FR.T("Are you sure you wish to remove the license registration?"),confirmHandler:function(){FR.licensing.panel.bwrap.mask("Please wait...");Ext.Ajax.request({url:FR.URLRoot+"/?module=cpanel&section=settings&page=license&action=remove",callback:function(){if(FR.licensing.panel){FR.licensing.panel.bwrap.unmask()}},success:function(req){try{var rs=Ext.util.JSON.decode(req.responseText)}catch(er){return false}if(!rs.success){new Ext.ux.prompt({text:rs.msg})}else{if(rs.msg){FR.feedback(rs.msg,"success")}}FR.licensing.refresh()},failure:function(f,a){FR.feedback(f.responseText,"error")},scope:this})}})}};FR.licensing.panel=new Ext.Panel({title:"Software licensing",layout:"fit",autoScroll:true,cls:"fr-admin-panel",html:FR.licensing.getHTML(),tbar:[{text:licenseInfo.key?"Update":"Register",cls:"fr-btn-primary",iconCls:licenseInfo.key?"fa-refresh":"fa-edit",handler:function(){if(!licenseInfo.key){FR.licensing.promptForEmail()}else{FR.licensing.update()}}},"->",{text:"Unregister",hidden:!licenseInfo.key,iconCls:"fa-remove colorDanger",handler:function(){FR.licensing.unregister()}}]});Ext.getCmp("appTab").add(FR.licensing.panel);Ext.getCmp("appTab").doLayout();